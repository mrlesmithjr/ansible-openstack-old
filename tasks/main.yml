---
# tasks file for ansible-openstack
- include: openstack_basic.yml

- include: openstack_rabbitmq_config.yml
  when: inventory_hostname in groups['openstack-controller-nodes']

- include: openstack_identity_services.yml
  when: inventory_hostname in groups['openstack-controller-nodes']

- include: openstack_keystone_tenants.yml  #Tenants are now projects
  when: inventory_hostname in groups['openstack-controller-nodes']

- include: openstack_keystone_users.yml
  when: inventory_hostname in groups['openstack-controller-nodes']

- include: openstack_keystone_roles.yml
  when: inventory_hostname in groups['openstack-controller-nodes']

- include: openstack_keystone_services.yml
  when: inventory_hostname in groups['openstack-controller-nodes']

- include: openstack_keystone_endpoints.yml
  when: inventory_hostname in groups['openstack-controller-nodes']

- include: openstack_image_services.yml
  when: inventory_hostname in groups['openstack-controller-nodes']

- include: openstack_compute_services.yml
  when: inventory_hostname in groups['openstack-controller-nodes']

- include: openstack_compute.yml
  when: inventory_hostname in groups['openstack-compute-nodes']

- include: openstack_neutron_controller_nodes.yml
  when: openstack_networking  == "neutron" and inventory_hostname in groups['openstack-controller-nodes']

- include: openstack_neutron_network_nodes.yml
  when: openstack_networking  == "neutron" and inventory_hostname in groups['openstack-network-nodes']

- include: openstack_neutron_compute_nodes.yml
  when: openstack_networking  == "neutron" and inventory_hostname in groups['openstack-compute-nodes']

- include: openstack_neutron_manage_external_networks.yml
  tags:
    - create_neutron_external_networks
    - neutron_networks
  when: openstack_networking  == "neutron" and inventory_hostname in groups['openstack-controller-nodes']

- include: openstack_neutron_create_tenant_networks.yml
  tags:
    - create_neutron_tenant_networks
    - neutron_networks
  when: openstack_networking  == "neutron" and inventory_hostname in groups['openstack-controller-nodes']

- include: openstack_horizon.yml
  tags:
    - horizon
  when: (openstack_horizon_install is defined and openstack_horizon_install) and inventory_hostname in groups['openstack-controller-nodes']

- include: openstack_heat.yml
  tags:
    - heat
  when: (openstack_heat_install is defined and openstack_heat_install) and inventory_hostname in groups['openstack-controller-nodes']

- include: openstack_group_based_policy.yml
  tags:
    - group_based_policy
  when: (openstack_group_based_policy_install is defined and openstack_group_based_policy_install) and inventory_hostname in groups['openstack-controller-nodes']
